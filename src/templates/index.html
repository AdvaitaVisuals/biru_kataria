<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOGA BHAI | Solo Creator OS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #050505;
            color: #ffffff;
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        .sidebar {
            width: 260px;
            background: rgba(255, 255, 255, 0.02);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            padding: 2rem 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 2rem 3rem;
        }

        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .nav-item {
            padding: 1rem;
            border-radius: 1rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 1rem;
            color: #94a3b8;
            font-weight: 600;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: white;
        }

        .nav-item.active {
            background: rgba(99, 102, 241, 0.1);
            color: #818cf8;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .accent-gradient {
            background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
        }

        .btn-ghost {
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
        }

        .btn-ghost:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #fff;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .section {
            display: none;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .wa-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 1.5rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
    </style>
</head>

<body class="custom-scrollbar">
    <!-- Sidebar Navigation -->
    <nav class="sidebar">
        <div>
            <div class="mb-12 px-2">
                <h1 class="text-2xl font-black tracking-tighter">GOGA BHAI<span class="text-indigo-500">.</span></h1>
                <p class="text-[10px] text-gray-500 font-bold uppercase tracking-widest mt-1">Intelligence OS</p>
            </div>
            <div class="space-y-2">
                <div class="nav-item active" onclick="showSection('section-content', this)">
                    <span class="text-xl">üöÄ</span> Content Engine
                </div>
                <div class="nav-item" onclick="showSection('section-whatsapp', this)">
                    <span class="text-xl">üì±</span> WhatsApp Agent
                </div>
                <div class="nav-item" onclick="showSection('section-strategy', this)">
                    <span class="text-xl">üß†</span> Strategy Lab
                </div>
                <div class="nav-item" onclick="showSection('section-analytics', this)">
                    <span class="text-xl">üìä</span> Analytics
                </div>
                <div class="nav-item" onclick="showSection('section-calendar', this)">
                    <span class="text-xl">üìÖ</span> Calendar
                </div>
            </div>
        </div>
        <div class="px-2">
            <div class="flex items-center gap-3 opacity-50">
                <span class="flex h-2 w-2 rounded-full bg-green-500"></span>
                <span class="text-[10px] uppercase font-bold tracking-widest">System Live</span>
            </div>
        </div>
    </nav>

    <!-- Main Dynamic Content -->
    <main class="main-content custom-scrollbar">

        <!-- SECTION: CONTENT ENGINE -->
        <div id="section-content" class="section active">
            <header class="flex justify-between items-center mb-10">
                <h2 class="text-3xl font-black">Content Engine</h2>
                <div class="flex items-center gap-6">
                    <div class="text-right">
                        <p class="text-[10px] text-gray-500 font-bold uppercase tracking-widest leading-none mb-1">Total
                            Clips</p>
                        <p class="text-xl font-black" id="total-assets">0</p>
                    </div>
                </div>
            </header>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <!-- Left: Controls -->
                <div class="lg:col-span-5 space-y-6">
                    <div class="glass p-8 rounded-3xl">
                        <label class="block text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">Ingest New
                            Video</label>
                        <div class="flex gap-2 mb-6">
                            <input type="text" id="yt-url" placeholder="YouTube Link..."
                                class="flex-1 bg-black/50 border border-white/10 p-4 rounded-2xl text-sm focus:outline-none focus:border-indigo-500 transition-all">
                            <button onclick="submitYouTube()" id="yt-btn"
                                class="accent-gradient p-4 rounded-2xl hover:scale-105 active:scale-95 transition-all">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M14 5l7 7m0 0l-7 7m7-7H3" />
                                </svg>
                            </button>
                        </div>
                        <div id="drop-zone"
                            class="border-2 border-dashed border-white/10 rounded-2xl p-10 text-center cursor-pointer hover:border-indigo-500/50 hover:bg-white/5 transition-all">
                            <input type="file" id="file-input" class="hidden" accept="video/*">
                            <div class="text-gray-500 text-sm font-medium">Click to upload file</div>
                        </div>
                    </div>

                    <div id="pipeline-visualizer" class="glass p-6 rounded-3xl">
                        <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">Neural Pipeline</h3>
                        <div id="pipeline-content" class="space-y-4">
                            <p class="text-gray-600 text-xs py-4">Awaiting signals...</p>
                        </div>
                    </div>

                    <div class="glass p-6 rounded-3xl h-48 flex flex-col">
                        <h3 class="text-[10px] font-bold text-indigo-400 uppercase tracking-widest mb-4">Brain Activity
                        </h3>
                        <div id="activity-log"
                            class="flex-1 overflow-y-auto text-[10px] font-mono space-y-2 custom-scrollbar opacity-60">
                            <div class="text-gray-500">>> Link established...</div>
                        </div>
                    </div>
                </div>

                <!-- Right: Assets -->
                <div class="lg:col-span-7">
                    <div id="assets-list" class="space-y-4 pb-20">
                        <div class="glass p-20 rounded-3xl text-center opacity-30 border-dashed border-2">
                            <p class="text-gray-500 font-bold uppercase tracking-widest">Feed Empty</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION: WHATSAPP AGENT -->
        <div id="section-whatsapp" class="section">
            <header class="flex justify-between items-center mb-10">
                <h2 class="text-3xl font-black">WhatsApp Agent</h2>
                <button onclick="loadWhatsAppMessages()"
                    class="btn-ghost px-6 py-2 rounded-xl text-xs font-black uppercase">Refresh Chat</button>
            </header>

            <div class="glass p-8 rounded-3xl min-h-[500px]">
                <div id="wa-messages-list" class="space-y-4">
                    <div class="text-center py-20 opacity-30">
                        <p class="font-bold uppercase tracking-widest">No conversation logs yet</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION: STRATEGY LAB -->
        <div id="section-strategy" class="section">
            <header class="mb-10">
                <h2 class="text-3xl font-black">Strategy Lab</h2>
            </header>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="glass p-10 rounded-3xl">
                    <h3 class="text-xl font-bold mb-4">Content Roadmap</h3>
                    <p class="text-gray-400 text-sm leading-relaxed">AI is analyzing your current content performance to
                        suggest the next 5 viral topics. This agent is currently training.</p>
                </div>
                <div class="glass p-10 rounded-3xl">
                    <h3 class="text-xl font-bold mb-4">Audience Persona</h3>
                    <p class="text-gray-400 text-sm leading-relaxed">Mapping common feedback from your WhatsApp and
                        YouTube comments to build a 360¬∞ audience profile.</p>
                </div>
            </div>
        </div>

        <!-- SECTION: ANALYTICS -->
        <div id="section-analytics" class="section">
            <header class="mb-10">
                <h2 class="text-3xl font-black">Deep Analytics</h2>
            </header>
            <div class="glass p-20 rounded-3xl text-center opacity-30 border-dashed border-2">
                <p class="font-bold uppercase tracking-widest">Analytics Engine Offline - Await Data Sync</p>
            </div>
        </div>

        <!-- SECTION: CALENDAR -->
        <div id="section-calendar" class="section">
            <header class="flex justify-between items-center mb-10">
                <h2 class="text-3xl font-black">Calendar</h2>
                <button onclick="document.getElementById('event-modal').classList.remove('hidden')"
                    class="btn-ghost px-6 py-2 rounded-xl text-xs font-black uppercase">New Event</button>
            </header>

            <div class="glass p-8 rounded-3xl min-h-[500px]">
                <div id="calendar-events-list" class="space-y-4">
                    <div class="text-center py-20 opacity-30">
                        <p class="font-bold uppercase tracking-widest">Syncing Schedule...</p>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Modal for Clips -->
    <div id="clip-modal" class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center p-4">
        <div class="glass max-w-5xl w-full max-h-[90vh] rounded-3xl overflow-hidden flex flex-col shadow-2xl">
            <div class="p-6 border-b border-white/10 flex justify-between items-center bg-white/5">
                <h3 id="modal-title" class="text-xl font-bold">Clips Detail</h3>
                <button onclick="closeModal()"
                    class="text-gray-400 hover:text-white font-black text-2xl px-4">&times;</button>
            </div>
            <div id="modal-content"
                class="flex-1 overflow-y-auto p-8 grid grid-cols-1 md:grid-cols-3 gap-6 custom-scrollbar"></div>
        </div>
    </div>

    <!-- Modal for New Event -->
    <div id="event-modal" class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center p-4">
        <div class="glass max-w-lg w-full rounded-3xl p-8 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold">New Event</h3>
                <button onclick="document.getElementById('event-modal').classList.add('hidden')"
                    class="text-gray-400 hover:text-white font-black text-2xl">&times;</button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-widest mb-1">Title</label>
                    <input type="text" id="evt-title"
                        class="w-full bg-black/50 border border-white/10 p-3 rounded-xl focus:border-indigo-500 outline-none">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase tracking-widest mb-1">Date</label>
                        <input type="date" id="evt-date"
                            class="w-full bg-black/50 border border-white/10 p-3 rounded-xl focus:border-indigo-500 outline-none date-picker-dark">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase tracking-widest mb-1">Time</label>
                        <input type="time" id="evt-time"
                            class="w-full bg-black/50 border border-white/10 p-3 rounded-xl focus:border-indigo-500 outline-none">
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-widest mb-1">Type</label>
                    <select id="evt-type"
                        class="w-full bg-black/50 border border-white/10 p-3 rounded-xl focus:border-indigo-500 outline-none">
                        <option value="MEETING">Meeting</option>
                        <option value="RECORDING">Recording Session</option>
                        <option value="VIRAL_DROP">Viral Video Drop</option>
                    </select>
                </div>
                <button onclick="submitEvent()"
                    class="w-full accent-gradient py-3 rounded-xl font-bold mt-4 hover:opacity-90 transition-all">Create
                    Event</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;

        function showSection(id, el) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');

            if (id === 'section-whatsapp') loadWhatsAppMessages();
            if (id === 'section-calendar') loadCalendarEvents();
        }

        function logActivity(msg, type = 'info') {
            const log = document.getElementById('activity-log');
            const color = type === 'error' ? 'text-red-400' : (type === 'success' ? 'text-green-400' : 'text-indigo-300');
            const time = new Date().toLocaleTimeString([], { hour12: false });
            log.innerHTML += `<div class="${color} flex gap-2"><span>[${time}]</span> <span class="break-all">${msg}</span></div>`;
            log.scrollTop = log.scrollHeight;
        }

        async function submitYouTube() {
            const urlInput = document.getElementById('yt-url');
            const url = urlInput.value;
            if (!url) return;
            logActivity(`Processing YouTube: ${url}`);
            const btn = document.getElementById('yt-btn');
            btn.innerHTML = '...';
            try {
                const res = await fetch(`${API_BASE}/assets/youtube`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: url, title: "YT - " + new Date().toLocaleTimeString() })
                });
                if (res.ok) {
                    urlInput.value = '';
                    logActivity(`Success: Asset registered.`, 'success');
                    loadAssets();
                }
            } catch (e) { logActivity(`Error: ${e.message}`, 'error'); }
            btn.innerHTML = '<svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>';
        }

        async function loadAssets() {
            try {
                const res = await fetch(`${API_BASE}/assets`);
                const assets = await res.json();
                document.getElementById('total-assets').innerText = assets.length;

                const list = document.getElementById('assets-list');
                if (assets.length === 0) return;

                const stepIcons = { 1: "üì•", 2: "üéôÔ∏è", 3: "üß†", 4: "‚úÇÔ∏è", 5: "üì§" };
                const stepNames = { 1: "Fetch", 2: "Transcribe", 3: "Analyze", 4: "Clip", 5: "Post" };

                list.innerHTML = assets.map(asset => {
                    const step = asset.pipeline_step || 0;
                    const stepName = stepNames[step] || (asset.status === 'READY' ? 'Complete' : (asset.status === 'FAILED' ? 'Failed' : 'Pending'));

                    // Determine Status Color
                    let statusColor = 'text-indigo-400';
                    if (asset.status === 'FAILED') statusColor = 'text-red-500';
                    if (asset.status === 'READY') statusColor = 'text-green-500';

                    let progressHtml = '<div class="flex gap-1 mt-2 w-full">';
                    for (let i = 1; i <= 5; i++) {
                        let color = 'bg-gray-800';
                        let labelColor = 'text-gray-600';

                        if (asset.status === 'FAILED' && i === step) {
                            color = 'bg-red-500'; // Failed step
                            labelColor = 'text-red-500';
                        } else if (i < step || asset.status === 'READY') {
                            color = 'bg-green-500';
                            labelColor = 'text-green-500';
                        } else if (i === step) {
                            color = 'bg-yellow-500 animate-pulse';
                            labelColor = 'text-yellow-500';
                        }

                        // Tooltip for step name
                        progressHtml += `
                            <div class="flex-1 flex flex-col gap-1 group/bar">
                                <div class="h-1.5 rounded-full ${color} w-full transition-all"></div>
                                <span class="text-[8px] font-bold uppercase ${labelColor} opacity-0 group-hover/bar:opacity-100 transition-opacity text-center">${stepNames[i]}</span>
                            </div>`;
                    }
                    progressHtml += '</div>';

                    return `
                    <div class="glass p-6 rounded-3xl flex flex-col md:flex-row items-center justify-between hover:bg-white/5 transition-all group gap-4">
                        <div class="flex items-center gap-5 w-full">
                            <div class="w-12 h-12 rounded-xl accent-gradient flex items-center justify-center font-black shrink-0 text-white">
                                ${asset.title.charAt(0).toUpperCase()}
                            </div>
                            <div class="flex-1 min-w-0">
                                <h3 class="font-bold truncate text-lg">${asset.title}</h3>
                                <div class="flex items-center gap-2 mt-1 mb-1">
                                    <p class="text-[10px] text-gray-400 uppercase font-black">ID: #${asset.id} | <span class="${statusColor}">${asset.status}</span></p>
                                    <span class="text-[10px] ${statusColor} font-bold uppercase ml-2">${stepName}</span>
                                </div>
                                ${progressHtml}
                            </div>
                        </div>
                        <button onclick="viewClips(${asset.id}, '${asset.title}')" class="btn-ghost px-6 py-2 rounded-xl text-xs font-black whitespace-nowrap">VIEW CLIPS</button>
                    </div>
                `;
                }).join('');

                // Update Detailed Pipeline Visualizer
                const active = assets.find(a => a.status === 'PENDING' || a.status === 'PROCESSING');
                const pipe = document.getElementById('pipeline-content');
                if (active) {
                    const step = active.pipeline_step || 1;
                    const status = active.pipeline_step_status || 'PENDING';

                    let stepsHtml = '';
                    for (let i = 1; i <= 5; i++) {
                        const isCurrent = (i === step);
                        const isPast = (i < step);
                        const opacity = isPast ? 'opacity-100' : (isCurrent ? 'opacity-100' : 'opacity-30');
                        const icon = stepIcons[i];
                        const label = stepNames[i];
                        const color = isPast ? 'text-green-400' : (isCurrent ? 'text-indigo-400' : 'text-gray-500');

                        stepsHtml += `
                            <div class="flex items-center gap-4 ${opacity}">
                                <div class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center text-sm">${icon}</div>
                                <div class="flex-1">
                                    <p class="text-[10px] font-bold ${color} uppercase tracking-tighter">${label}</p>
                                    ${isCurrent ? `<div class="w-full bg-white/5 h-1 rounded-full mt-1 overflow-hidden"><div class="bg-indigo-500 h-full animate-progress" style="width: 50%"></div></div>` : ''}
                                </div>
                                ${isPast ? '<span>‚úÖ</span>' : (isCurrent ? '<div class="w-1.5 h-1.5 bg-indigo-500 rounded-full animate-ping"></div>' : '')}
                            </div>
                        `;
                    }
                    pipe.innerHTML = stepsHtml;

                    // AUTO-ADVANCE LOGIC
                    if (status === 'PENDING' || status === 'COMPLETED' || (status === 'RUNNING' && Math.random() > 0.8)) {
                        // Only advance if ready for next or periodically Check
                        advancePipeline(active.id);
                    }
                } else {
                    pipe.innerHTML = '<p class="text-gray-600 text-xs py-4">All engines clear. Awaiting new signal.</p>';
                }
            } catch (e) { console.error(e); }
        }

        async function advancePipeline(id) {
            try {
                const res = await fetch(`${API_BASE}/pipeline/${id}/advance`, { method: 'POST' });
                if (res.ok) {
                    const data = await res.json();
                    logActivity(`Pipeline Advance: Step ${data.step_advanced_to} ${data.status}`);
                    loadAssets();
                }
            } catch (e) { }
        }

        async function loadWhatsAppMessages() {
            const list = document.getElementById('wa-messages-list');
            list.innerHTML = '<div class="text-center py-20 animate-pulse text-gray-500">Syncing Conversations...</div>';
            try {
                const res = await fetch(`${API_BASE}/whatsapp/messages`);
                const msgs = await res.json();
                if (msgs.length === 0) {
                    list.innerHTML = '<div class="text-center py-20 opacity-30 font-bold uppercase tracking-widest">No logs found</div>';
                    return;
                }
                list.innerHTML = msgs.map(m => `
                    <div class="wa-card">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-indigo-400 font-black text-xs">SENDER: ${m.sender}</span>
                            <span class="text-[10px] text-gray-600 font-mono">${m.timestamp.slice(0, 19)}</span>
                        </div>
                        <div class="space-y-4">
                            <div class="bg-black/40 p-3 rounded-xl border border-white/5">
                                <p class="text-[9px] text-gray-500 font-black uppercase mb-1">Message</p>
                                <p class="text-sm text-gray-300 italic">"${m.message}"</p>
                            </div>
                            <div class="bg-indigo-500/5 p-3 rounded-xl border border-indigo-500/10">
                                <p class="text-[9px] text-indigo-400 font-black uppercase mb-1">Biru Bhai Reply</p>
                                <div class="text-sm text-indigo-100 font-medium">${m.response ? m.response.replace(/\n/g, '<br>') : '...Processing'}</div>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                list.innerHTML = '<div class="text-center py-20 text-red-500 font-black uppercase tracking-widest">Neural link failed</div>';
            }
        }

        async function viewClips(id, title) {
            document.getElementById('modal-title').innerText = title;
            const modal = document.getElementById('clip-modal');
            const content = document.getElementById('modal-content');
            content.innerHTML = '<div class="col-span-full py-40 text-center animate-pulse">Syncing...</div>';
            modal.classList.remove('hidden');
            try {
                const res = await fetch(`${API_BASE}/assets/${id}`);
                const data = await res.json();

                if (data.status === 'FAILED' || data.error_message) {
                    content.innerHTML = `
                        <div class="col-span-full py-10 text-center">
                            <p class="text-red-500 font-black uppercase tracking-widest text-xl mb-4">PIPELINE FAILURE</p>
                            <div class="bg-red-500/10 border border-red-500/20 p-6 rounded-2xl text-left font-mono text-xs text-red-200 overflow-x-auto whitespace-pre-wrap">
                                ${data.error_message || "Unknown error occurred during processing."}
                            </div>
                        </div>
                    `;
                    return;
                }

                if (!data.clips || data.clips.length === 0) {
                    content.innerHTML = '<div class="col-span-full py-40 text-center text-gray-500 font-black uppercase tracking-widest">No clips forged yet. Check status.</div>';
                    return;
                }
                content.innerHTML = data.clips.map(clip => `
                    <div class="space-y-3">
                        <div class="aspect-[9/16] bg-black rounded-3xl overflow-hidden shadow-2xl relative">
                            <video src="${clip.file_path}" controls class="w-full h-full object-cover"></video>
                            <div class="absolute top-4 left-4">
                                <span class="bg-indigo-500 text-white text-[9px] font-black px-2 py-1 rounded">SCORE: ${clip.virality_score}</span>
                            </div>
                        </div>
                        <p class="text-[10px] text-gray-500 font-black text-center uppercase tracking-widest">${Math.round(clip.duration)} Seconds</p>
                    </div>
                `).join('');
            } catch (e) {
                content.innerHTML = `<div class="col-span-full py-40 text-center text-red-500 font-black uppercase tracking-widest">System Error: ${e.message}</div>`;
            }
        }

        function closeModal() { document.getElementById('clip-modal').classList.add('hidden'); }

        async function loadCalendarEvents() {
            const list = document.getElementById('calendar-events-list');
            list.innerHTML = '<div class="text-center py-20 animate-pulse text-gray-500">Syncing Schedule...</div>';
            try {
                const res = await fetch(`${API_BASE}/calendar/events`);
                const events = await res.json();
                if (events.length === 0) {
                    list.innerHTML = '<div class="text-center py-20 opacity-30 font-bold uppercase tracking-widest">Calendar Empty</div>';
                    return;
                }
                list.innerHTML = events.map(e => `
                    <div class="glass p-4 rounded-2xl flex items-center justify-between border-l-4 ${e.type === 'VIRAL_DROP' ? 'border-red-500' : (e.type === 'RECORDING' ? 'border-purple-500' : 'border-indigo-500')}">
                        <div>
                            <div class="flex items-center gap-3">
                                <h4 class="font-bold text-lg">${e.title}</h4>
                                <span class="bg-white/10 text-[10px] font-black px-2 py-0.5 rounded uppercase">${e.type}</span>
                            </div>
                            <p class="text-xs text-gray-400 mt-1">${e.time}</p>
                        </div>
                        <div class="opacity-50 text-2xl">
                            ${e.type === 'VIRAL_DROP' ? 'üî•' : (e.type === 'RECORDING' ? 'üéôÔ∏è' : 'üìÖ')}
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                list.innerHTML = '<div class="text-center py-20 text-red-500 font-bold">Failed to load calendar</div>';
            }
        }

        async function submitEvent() {
            const title = document.getElementById('evt-title').value;
            const date = document.getElementById('evt-date').value;
            const time = document.getElementById('evt-time').value;
            const type = document.getElementById('evt-type').value;

            if (!title || !date || !time) return alert("Please fill all fields");

            const isoDate = new Date(`${date}T${time}`).toISOString();

            try {
                const res = await fetch(`${API_BASE}/calendar/events`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, start_time: isoDate, event_type: type })
                });
                if (res.ok) {
                    document.getElementById('event-modal').classList.add('hidden');
                    loadCalendarEvents();
                    logActivity(`New Event Scheduled: ${title}`, 'success');
                } else {
                    alert('Failed to create event');
                }
            } catch (e) { alert(e.message); }
        }

        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        dropZone.onclick = () => fileInput.click();
        fileInput.onchange = (e) => handleUpload(e.target.files[0]);

        async function handleUpload(file) {
            if (!file) return;
            const formData = new FormData();
            formData.append('file', file);
            formData.append('title', file.name.split('.')[0]);
            logActivity(`Uploading: ${file.name}`);
            try {
                const res = await fetch(`${API_BASE}/assets/upload`, { method: 'POST', body: formData });
                if (res.ok) { logActivity(`Upload Complete`, 'success'); loadAssets(); }
            } catch (e) { logActivity(`Upload Failed`, 'error'); }
        }

        loadAssets();
        setInterval(loadAssets, 60000);
    </script>
</body>

</html>